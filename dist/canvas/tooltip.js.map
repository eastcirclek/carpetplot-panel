{"version":3,"sources":["../../src/canvas/tooltip.js"],"names":["d3","$","moment","TOOLTIP_PADDING_X","TOOLTIP_PADDING_Y","CarpetplotTooltip","elem","scope","ctrl","tooltip","dashboard","panel","on","onMouseOver","bind","onMouseLeave","e","show","hasData","move","destroy","select","append","attr","remove","pos","bucket","isInChart","hasValue","add","tooltipTimeFormat","time","formatDate","timestamp","value","decimals","data","_","round","isInteger","percentage","parseFloat","multiply","toFixed","target","tooltipHtml","html","node","pageX","pageY","tooltipWidth","clientWidth","tooltipHeight","clientHeight","left","top","window","innerWidth","pageYOffset","innerHeight","style"],"mappings":";;;;;;;;;;;;;;;AAAOA,Q;;AACAC,O;;AACAC,Y;;;;;;;;;;;;;;;;;;;;;AAEHC,uB,GAAoB,E;AACpBC,uB,GAAoB,C;;AAElBC,uB;AAEJ,mCAAYC,IAAZ,EAAkBC,KAAlB,EAAyBC,IAAzB,EAA+B;AAAA;;AAC7B,eAAKC,OAAL,GAAe,IAAf;AACA,eAAKF,KAAL,GAAaA,KAAb;AACA,eAAKG,SAAL,GAAiBH,MAAMC,IAAN,CAAWE,SAA5B;AACA,eAAKC,KAAL,GAAaJ,MAAMC,IAAN,CAAWG,KAAxB;AACA,eAAKH,IAAL,GAAYA,IAAZ;;AAEAF,eAAKM,EAAL,CAAQ,WAAR,EAAqB,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAArB;AACAR,eAAKM,EAAL,CAAQ,YAAR,EAAsB,KAAKG,YAAL,CAAkBD,IAAlB,CAAuB,IAAvB,CAAtB;AACD;;;;sCAEWE,C,EAAG;AACb,gBAAI,CAAC,KAAKL,KAAL,CAAWF,OAAX,CAAmBQ,IAApB,IAA4B,CAAC,KAAKV,KAAL,CAAWW,OAAX,EAAjC,EAAuD;AAAE;AAAS;;AAElE,gBAAI,CAAC,KAAKT,OAAV,EAAmB;AACjB,mBAAKU,IAAL,CAAUH,CAAV;AACD;AACF;;;yCAEc;AACb,iBAAKI,OAAL;AACD;;;sCAEWJ,C,EAAG;AACb,gBAAI,CAAC,KAAKL,KAAL,CAAWF,OAAX,CAAmBQ,IAAxB,EAA8B;AAAE;AAAS;;AAEzC,gBAAI,CAAC,KAAKR,OAAV,EAAmB;AACjB,mBAAKU,IAAL,CAAUH,CAAV;AACD;AACF;;;gCAEK;AACJ,iBAAKP,OAAL,GAAeT,GAAGqB,MAAH,CAAU,MAAV,EACZC,MADY,CACL,KADK,EAEZC,IAFY,CAEP,OAFO,EAEE,8CAFF,CAAf;AAGD;;;oCAES;AACR,gBAAI,KAAKd,OAAT,EAAkB;AAChB,mBAAKA,OAAL,CAAae,MAAb;AACD;;AAED,iBAAKf,OAAL,GAAe,IAAf;AACD;;;+BAEIgB,G,EAAKC,M,EAAQ;AAChB,gBAAI,CAACA,MAAD,IAAW,CAAC,KAAKf,KAAL,CAAWF,OAAX,CAAmBQ,IAA/B,IAAuC,CAAC,KAAKV,KAAL,CAAWoB,SAAX,CAAqBF,GAArB,CAAxC,IAAqE,CAACC,OAAOE,QAAP,EAA1E,EAA6F;AAC3F,mBAAKR,OAAL;AACA;AACD;;AAED,gBAAI,CAAC,KAAKX,OAAV,EAAmB;AACjB,mBAAKoB,GAAL;AACD;;AAED,gBAAMC,oBAAoB,gBAA1B;AACA,gBAAMC,OAAO,KAAKrB,SAAL,CAAesB,UAAf,CAA0BN,OAAOO,SAAjC,EAA4CH,iBAA5C,CAAb;AACA,gBAAII,QAAQR,OAAOQ,KAAnB;;AAEA,gBAAMC,WAAW,KAAKxB,KAAL,CAAWyB,IAAX,CAAgBD,QAAjC;AACA,gBAAIA,QAAJ,EAAc;AACZD,sBAAQG,EAAEC,KAAF,CAAQJ,KAAR,EAAeG,EAAEE,SAAF,CAAYL,KAAZ,IAAqB,CAArB,GAA0BC,YAAY,CAArD,CAAR;AACD;;AAED,gBAAI,KAAK3B,IAAL,CAAUG,KAAV,CAAgByB,IAAhB,CAAqBI,UAArB,KAAoC,IAAxC,EAA8C;AAC5CN,sBAAQO,WAAWJ,EAAEK,QAAF,CAAWR,KAAX,EAAkB,GAAlB,EAAuBS,OAAvB,CAA+BR,QAA/B,CAAX,IAAuD,GAA/D;AACD;AACD,gBAAMS,SAASlB,OAAOkB,MAAtB;;AAEA,gBAAIC,6DACgCd,IADhC,uDAGGa,MAHH,iBAGqBV,KAHrB,8BAAJ;;AAOA,iBAAKzB,OAAL,CAAaqC,IAAb,CAAkBD,WAAlB;;AAEA,iBAAK1B,IAAL,CAAUM,GAAV;AACD;;;+BAEIA,G,EAAK;AACR,gBAAI,CAAC,KAAKhB,OAAV,EAAmB;AAAE;AAAS;;AAE9B,gBAAMH,OAAOL,EAAE,KAAKQ,OAAL,CAAasC,IAAb,EAAF,EAAuB,CAAvB,CAAb;AAHQ,gBAIAC,KAJA,GAIiBvB,GAJjB,CAIAuB,KAJA;AAAA,gBAIOC,KAJP,GAIiBxB,GAJjB,CAIOwB,KAJP;;AAKR,gBAAMC,eAAe5C,KAAK6C,WAA1B;AACA,gBAAMC,gBAAgB9C,KAAK+C,YAA3B;;AAEA,gBAAIC,OAAON,QAAQ7C,iBAAnB;AACA,gBAAIoD,MAAMN,QAAQ7C,iBAAlB;;AAEA,gBAAI4C,QAAQE,YAAR,GAAuB,EAAvB,GAA4BM,OAAOC,UAAvC,EAAmD;AACjDH,qBAAON,QAAQE,YAAR,GAAuB/C,iBAA9B;AACD;;AAED,gBAAI8C,QAAQO,OAAOE,WAAf,GAA6BN,aAA7B,GAA6C,EAA7C,GAAkDI,OAAOG,WAA7D,EAA0E;AACxEJ,oBAAMN,QAAQG,aAAR,GAAwBhD,iBAA9B;AACD;;AAED,mBAAO,KAAKK,OAAL,CACJmD,KADI,CACE,MADF,EACUN,OAAO,IADjB,EAEJM,KAFI,CAEE,KAFF,EAESL,MAAM,IAFf,CAAP;AAGD;;;;;;yBAGYlD,iB","file":"tooltip.js","sourcesContent":["import d3 from 'd3';\nimport $ from 'jquery';\nimport moment from 'moment';\n\nlet TOOLTIP_PADDING_X = 30;\nlet TOOLTIP_PADDING_Y = 5;\n\nclass CarpetplotTooltip {\n\n  constructor(elem, scope, ctrl) {\n    this.tooltip = null;\n    this.scope = scope;\n    this.dashboard = scope.ctrl.dashboard;\n    this.panel = scope.ctrl.panel;\n    this.ctrl = ctrl;\n\n    elem.on('mouseover', this.onMouseOver.bind(this));\n    elem.on('mouseleave', this.onMouseLeave.bind(this));\n  }\n\n  onMouseOver(e) {\n    if (!this.panel.tooltip.show || !this.scope.hasData()) { return; }\n\n    if (!this.tooltip) {\n      this.move(e);\n    }\n  }\n\n  onMouseLeave() {\n    this.destroy();\n  }\n\n  onMouseMove(e) {\n    if (!this.panel.tooltip.show) { return; }\n\n    if (!this.tooltip) {\n      this.move(e);\n    }\n  }\n\n  add() {\n    this.tooltip = d3.select('body')\n      .append('div')\n      .attr('class', 'carpet-tooltip graph-tooltip grafana-tooltip');\n  }\n\n  destroy() {\n    if (this.tooltip) {\n      this.tooltip.remove();\n    }\n\n    this.tooltip = null;\n  }\n\n  show(pos, bucket) {\n    if (!bucket || !this.panel.tooltip.show || !this.scope.isInChart(pos) || !bucket.hasValue()) {\n      this.destroy();\n      return;\n    }\n\n    if (!this.tooltip) {\n      this.add();\n    }\n\n    const tooltipTimeFormat = 'YY-MM-DD HH:mm';\n    const time = this.dashboard.formatDate(bucket.timestamp, tooltipTimeFormat);\n    let value = bucket.value;\n\n    const decimals = this.panel.data.decimals;\n    if (decimals) {\n      value = _.round(value, _.isInteger(value) ? 0 : (decimals || 5));\n    }\n\n    if (this.ctrl.panel.data.percentage === true) {\n      value = parseFloat(_.multiply(value, 100).toFixed(decimals)) + '%';\n    }\n    const target = bucket.target;\n\n    let tooltipHtml = `\n      <div class='graph-tooltip-time'>${time}</div>\n      <div align='center'>\n      <b>${target}</b><br/>${value}<br/>\n      </div>\n    `;\n\n    this.tooltip.html(tooltipHtml);\n\n    this.move(pos);\n  }\n\n  move(pos) {\n    if (!this.tooltip) { return; }\n\n    const elem = $(this.tooltip.node())[0];\n    const { pageX, pageY } = pos;\n    const tooltipWidth = elem.clientWidth;\n    const tooltipHeight = elem.clientHeight;\n\n    let left = pageX + TOOLTIP_PADDING_X;\n    let top = pageY + TOOLTIP_PADDING_Y;\n\n    if (pageX + tooltipWidth + 40 > window.innerWidth) {\n      left = pageX - tooltipWidth - TOOLTIP_PADDING_X;\n    }\n\n    if (pageY - window.pageYOffset + tooltipHeight + 20 > window.innerHeight) {\n      top = pageY - tooltipHeight - TOOLTIP_PADDING_Y;\n    }\n\n    return this.tooltip\n      .style('left', left + 'px')\n      .style('top', top + 'px');\n  }\n}\n\nexport default CarpetplotTooltip;"]}